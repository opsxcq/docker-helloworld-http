version: '1.0'
steps:
  build_step:
    title: Building docker image
    type: build
    dockerfile: Dockerfile
    image_name: codefresh/docker-helloworld-http
    metadata:
      set:
        - CF_QUALITY: true

  helm_package:
    title: Building helm package from current commit
    image: codefresh/kube-helm:master
    commands:
    - ./bin/package-chart.sh

  push:
    title: Pushing image to Dockerhub
    type: push
    image_name: codefresh/docker-helloworld-http
    candidate: ${{build_step}}
    tags:
    - ${{VERSION}}

  run_cd:
    title: Executine CD pipeline
    image: codefresh/cli
    commands:
    - sh bin/run-cd.sh
    fail_fast: false